<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game</title>
  <style>
    /* overflow: hidden */
    body {margin: 0; padding: 0;}
    h1, h2, h3, h4, h5, h6 {margin-top: 0;}
    ul, ol {margin: 0;}
    p {margin: 0;}

    .container{
      width: 100vw=350;
      height: 100vh;
      box-sizing: border-box;
     background-color: #08101B;
     display: flex;
     flex-direction: row;
     justify-content: space-around;
     /* #081D32;  светлее*/
    }
    .game{
      height: 100vh;
      background:  url('11.jpeg') no-repeat center;
      position: relative;
      /* background-size: 100%; */
      

 
    }
    .menu{
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* #ballId{
      animation: rotation 100ms infinite linear;
  transform-origin: 50% 50%;
  
    }
    @keyframes rotation {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(359deg);
    } */

    /* #rocketId */
    /* #Shiny{
      animation: MyAnimation2 2s infinite;
    }
    @keyframes MyAnimation2{
    from { background-color: cyan; color: red }
    50% { background-color: magenta; color: red }
    to { background-color: cyan; color: blue }
} */


    @media all and (max-width: 780px){
      .container{
        flex-direction: column;
      }
      /* .game{
        width: 100vw;
      } */
      .menu{
        flex-direction: row;
        justify-content: space-around;
      }

      #ballId{
        position: absolute;
      }

    }

  </style>
</head>
<body>
  <div class="container">
    <div class="menu">
      <input type=button value='Новая игра' onclick='start()'>
      <input type=button value='Правила'>
      <input type=button value='Таблица рекордов'>
    </div>
    
    <div class="game">
      <svg id='svgGameId' version="1.0"  width="700" height="700" xmlns="http://www.w3.org/2000/svg">
       <!-- <defs>
        <linearGradient id='Shiny' gradientUnits="userSpaceOnUse" cx="0.5" cy="0.5" r="0.5" fx="0.25" fy="0.25">
          <stop offset="4.293300e-002" style="stop-color:#ffffff;" />
          <stop offset="5.000000e-002" style="stop-color:#8CB0D4;" />
          <stop offset="7.944028e-002" style="stop-color:#424242;" />
          <stop offset="1" style="stop-color:red">
          <animate attributeName="stop-opacity" values="0; 1" dur="1s" repeatCount="indefinite"></animate>
          </stop>
        </linearGradient>
       </defs> -->
        <defs>
        <radialGradient id="Shiny"
          cx="0.5" cy="0.5" r="0.5" fx="0.25" fy="0.25">

         <stop offset="0%" stop-color="#ffffff" >
         <!-- <animate attributeName="stop-color" values="#ffffff; #87CEEB" dur="2000ms" repeatCount="indefinite" /> -->
        </stop>
         <!-- <animate attributeName="stop-color" dur="24s" values="rgba(0,0,12,0);rgba(25,22,33,.3);rgba(32,32,44,.8);rgb(58,58,82);" repeatCount="indefinite" /> -->
         <stop offset="60%" stop-color="#8CB0D4" >
          <!-- <animate attributeName="stop-color" values="#8CB0D4; #999999" dur="1000ms" repeatCount="indefinite" /> -->
        </stop>
         <!-- <animate attributeName="stop-color" dur="24s" values="rgba(0,0,12,0);rgba(25,22,33,.3);rgba(32,32,44,.8);rgb(58,58,82);" repeatCount="indefinite" /> -->
         <stop offset="100%" stop-color="#424242" >
          <!-- <animate attributeName="stop-color" values="#424242; #87CEEB" dur="1000ms" repeatCount="indefinite" /> -->
        </stop>
        <!-- <animate attributeName="fy"  dur="2000ms" from="100%" to="50%" repeatCount="indefinite" /> -->
         
         <!-- <animate attributeName="fx"  dur="2000ms" from="100%" to="0%" repeatCount="indefinite" /> -->
         <!-- <stop offset="1" style="stop-color:#000000;stop-opacity:0"> -->
          <!-- <animate attributeName="stop-opacity" values="0; 1" dur="3s" repeatCount="indefinite"></animate> -->
          <!-- </stop> -->
         <!-- <animate attributeName="stop-color" dur="24s" values="rgba(0,0,12,0);rgba(25,22,33,.3);rgba(32,32,44,.8);rgb(58,58,82);" repeatCount="indefinite" /> -->
         <!-- <stop offset="100%" stop-color="#000000" /> --=350;
         <!-- <stop offset="50%" stop-color="#aa66cc" />
         <stop offset="75%" stop-color="#553366" />
         <stop offset="100%" stop-color="#000000" /> -->
        </radialGradient>
       </defs>
       <circle id='ballId'   fill="url(#Shiny)" />
       <!-- style='position: absolute' style='position: relative' -->

       <!-- <defs>
        <linearGradient id='LG1' x1='0%' y1='0%' x2='0%' y2='100%'>
            <stop offset='0%' stop-color=white />
            <stop offset='80%' stop-color=#7FFF00 /> 
            <stop offset='100%' stop-color=#7FFF00 stop-opacity=0.5 />
        </linearGradient> -->
        <!-- <linearGradient id='LG2' x1='0%' y1='0%' x2='0%' y2='100%'>
          <stop offset='0%' stop-color=white />
          <stop offset='80%' stop-color=#FF0000 /> 
          <stop offset='100%' stop-color=#FF0000 stop-opacity=0.5 />
      </linearGradient>
      <linearGradient id='LG3' x1='0%' y1='0%' x2='0%' y2='100%'>
        <stop offset='0%' stop-color=white />
        <stop offset='80%' stop-color=#FFD700 /> 
        <stop offset='100%' stop-color=#FFD700 stop-opacity=0.5 />
    </linearGradient>
    <linearGradient id='LG4' x1='0%' y1='0%' x2='0%' y2='100%'>
      <stop offset='0%' stop-color=white />
      <stop offset='80%' stop-color=#9932CC /> 
      <stop offset='100%' stop-color=#9932CC stop-opacity=0.5 />
  </linearGradient>
  <linearGradient id='LG5' x1='0%' y1='0%' x2='0%' y2='100%'>
    <stop offset='0%' stop-color=white />
    <stop offset='80%' stop-color=#0000FF /> 
    <stop offset='100%' stop-color=#0000FF stop-opacity=0.5 />
</linearGradient> -->
    <!-- </defs>
    <rect x=5 y=5 width=80 height=40 rx='15' fill='url(#LG1)' /> -->
    <!-- <rect x=5 y=60 width=80 height=40 rx='15' fill='url(#LG2)' />
    <rect x=5 y=110 width=80 height=40 rx='15' fill='url(#LG3)' />
    <rect x=5 y=170 width=80 height=40 rx='15' fill='url(#LG4)' />
    <rect x=5 y=230 width=80 height=40 rx='15' fill='url(#LG5)' /> -->
      </svg>
    </div>

  </div>
  <script>
    'use strict'
    var RAF=
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.oRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      function(callback)
      { window.setTimeout(callback, 1000 / 60); }

    let clientWidth=document.documentElement.clientWidth;
    let clientHeight=document.documentElement.clientHeight;

    function checkMediaQuery() {
      if (window.innerWidth < 780) {
      console.log('Media Query Matched!')
      field.style.width='100vw';
      let widthFieldMob=document.documentElement.clientWidth;
      console.log(widthFieldMob)
      ball.setAttribute('r', widthFieldMob*0.03);  
      }
    }
    window.addEventListener('resize', checkMediaQuery);

    let svgGame=document.getElementById('svgGameId');
    svgGame.setAttribute('width', 700);
    svgGame.setAttribute('height', clientHeight);

//field
    let field=document.querySelector('.game');
    let widthField=700; // все построения от ширины
    let heightField=clientHeight;
    field.style.width=widthField+'px';

//ball
    let ballIdJs=document.getElementById('ballId')
    let rBall=widthField*0.025; //радиус мяча
    function Ball(id){
      let self=this;
      id.setAttribute('r',rBall); 
      // let cx=widthField/2;
      // let cy=heightField/2;
      self.posX=widthField/2; //расположения центра мяча x
      self.posY=heightField/2; //расположения центра мяча y
      // id.setAttribute('cx',cx);
      // id.setAttribute('cy',cy);
      self.width=rBall*2;
      self.height=rBall*2;
      self.update= function(){
        // id.style.transform="translateX("+self.posX+"px) translateY("+self.posY+"px) translateZ(0)";
      id.setAttribute('cx',self.posX);
      id.setAttribute('cy',self.posY);
      };
    }
    let ball=new Ball(ballIdJs)


//brick 
    var brickRowCount = 3; //кол-во строк
    var brickColumnCount = 6; //кол-во столбцов
    var brickWidth = 80; //
    var brickHeight = 40; //
    var brickPadding = (widthField-(brickWidth*(brickColumnCount+2)))/brickColumnCount; // расстояние между
    var brickOffsetTop = clientHeight*0.12; //? смещение
    var brickOffsetLeft = 30;

    var bricks = [];
    for(var c=0; c<brickColumnCount; c++) {
        bricks[c] = [];
        for(var r=0; r<brickRowCount; r++) {
            bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
    }
    let brick;
    let brickRect=[];
     //let color=`<defs><linearGradient x1='0%' y1='0%' x2='0%' y2='100%'><stop offset='0%' stop-color=white /><stop offset='80%' stop-color=#7FFF00 /> <stop offset='100%' stop-color=#7FFF00 stop-opacity=0.5 /></linearGradient></defs>`
        //color=`red`

        

    function drawBricks() {
        for(var c=0; c<brickColumnCount; c++) {
            for(var r=0; r<brickRowCount; r++) {
              if(bricks[c][r].status == 1){
                var brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft;
              var brickY = (r*(brickHeight+brickPadding))+brickOffsetTop;
                bricks[c][r].x = brickX;
                bricks[c][r].y = brickY;
                brick=document.createElementNS("http://www.w3.org/2000/svg",'rect');
                
                brick.setAttribute('x', brickX);
                brick.setAttribute('y', brickY);
                brick.setAttribute('width', brickWidth);
                brick.setAttribute('height', brickHeight);
                brick.setAttribute('rx', '15');
              // createGradient(colorChoice())
              const colorArr=['#7FFF00', '#FF0000', '#FFFF14', '#9932CC', '#0000FF']
    function colorChoice(){
      return colorArr[Math.floor(Math.random() * colorArr.length)]
    }
        
        // function createGradient(color) {
    var defs = document.createElementNS("http://www.w3.org/2000/svg",'defs');
    var linearGradient = document.createElementNS("http://www.w3.org/2000/svg",'linearGradient');
    linearGradient.setAttribute('x1', '0%');
    linearGradient.setAttribute('x2', '0%');
    linearGradient.setAttribute('y1', '0%');
    linearGradient.setAttribute('y2', '80%');
    defs.appendChild(linearGradient);
    linearGradient.setAttribute('id', colorChoice());

    var stop1 = document.createElementNS("http://www.w3.org/2000/svg",'stop');
    stop1.setAttribute("offset", "2%");
    stop1.setAttribute("stop-color", "#424242");

    var stop2 = document.createElementNS("http://www.w3.org/2000/svg",'stop');
    stop2.setAttribute("offset", "100%");
    stop2.setAttribute("stop-color",colorChoice());

    svgGame.appendChild(defs);
    defs.appendChild(linearGradient);
    linearGradient.appendChild(stop1);
    linearGradient.appendChild(stop2);
      // }
      //createGradient(colorChoice())
            brick.setAttribute('fill', `url(#${colorChoice()})`);
            //console.log(`5${brick.style.fill}5`)
            //stop2.setAttribute("stop-color",colorChoice());
            
            //brick.setAttribute('fill', `<defs><linearGradient x1='0%' y1='0%' x2='0%' y2='100%'><stop offset='0%' stop-color=white /><stop offset='80%' stop-color=#7FFF00 /> <stop offset='100%' stop-color=#7FFF00 stop-opacity=0.5 /></linearGradient></defs>`);
           // brick.style.fill =`${color}`
           // brick.setAttribute('fill', `<lineargradient x1='0%' y1='0%' x2='0%' y2='100%'><stop offset='0%' stop-color=white /><stop offset='80%' stop-color=#7FFF00 /> <stop offset='100%' stop-color=#7FFF00 stop-opacity=0.5 /></lineargradient>`);

            // console.log(brick)
            // console.log(bricks[c][r])
            //svgGame.appendChild(brick);
           // stop2.setAttribute("stop-color",colorChoice());
            brickRect.push(brick)
            svgGame.appendChild(brick);
            //console.log(brick.style.fill.defs.linearGradient.stop2)
            //console.log(`5${brick.style.fill}5`)
          }
          }
    }
    }
    drawBricks();
    //brick.style.fill.innerHTML=color



    // delete brick 
    function collisionDetection() {
        for(var c=0; c<brickColumnCount; c++) {
            for(var r=0; r<brickRowCount; r++) {
                var b = bricks[c][r]; // конкретный кирпич
              
                // calculations
                //ball.posX-rBall > b.x && ball.posX+rBall < b.x+brickWidth && ball.posY+rBall > b.y && ball.posY < b.y+brickHeight
                if(b.status == 1){
                  // if(ball.posX+rBall > b.x && ball.posX-rBall < b.x+brickWidth && ball.posY-rBall> b.y && ball.posY-rBall< b.y+brickHeight) {
                  if(ball.posX+rBall > b.x && ball.posX-rBall < b.x+brickWidth && ball.posY-rBall  > b.y && ball.posY-rBall < b.y+brickHeight) {
                  ball.speedY=-ball.speedY;
                  b.status = 0;
                  //brick.setAttribute('fill', 'yellow');
                  //console.log(document.querySelector("rect[x='30'][y='30']"))
                                    //brick.setAttribute("style","display:none;");
                  document.querySelector(`rect[x='${b.x}'][y='${b.y}']`).setAttribute("style","display:none;");
                  score++;
                  scoreSVG.innerHTML=`Score: ${score}`
                  if(score==brickColumnCount*brickRowCount){
                    
                    ball.speedX=0;
                    ball.speedY=0;

                  }

              
  
                }
                }
            }
        }
    }

//rocketAll
    let rocket; 
    let widthRocket;
    let heightRocket;
    let rightPressed = false;
    let leftPressed = false;
    document.addEventListener("keydown", keyDown);
    document.addEventListener("keyup", keyUp);
    document.addEventListener("mousemove", mouseMove);

    function Rocket(){
    let self=this;

    rocket=document.createElementNS("http://www.w3.org/2000/svg",'rect');
    widthRocket=widthField*0.29;
    heightRocket=widthField*0.025;
    self.posX=(widthField-widthRocket)/2;
    self.posY=heightField-heightRocket;
    // self.posX=0;
    // self.posY=0;
 
    rocket.setAttribute('x', self.posX);//середина
    rocket.setAttribute('y', self.posY);//380
    rocket.setAttribute('width', widthRocket);
    rocket.setAttribute('height', heightRocket);
    rocket.setAttribute('rx', '30');
    rocket.setAttribute('fill', 'url(#Shiny)');
    rocket.setAttribute('id', 'rocketId');
    svgGame.appendChild(rocket)

    // rocketName.style.position='absolute';

    // widthRocket=widthField*0.015;
    // heightRocket=heightField*0.25;
    // rocketName.style.width=widthRocket+'px';
    // rocketName.style.height=heightRocket+'px';
    // rocketName.style.backgroundColor='#09AA57';
    // field.appendChild(rocketName)

    self.speedX=8;

    self.right=function(){
        self.posX+=self.speedX;
        if(self.posX+widthRocket>widthField){
            self.posX=widthField-widthRocket;
        }
        return self;
    }
    self.left=function(){
        self.posX-=self.speedX;
        if(self.posX<0){
            self.posX=0;
        }
        return self;
    }
    self.update=function(){
      rocket.setAttribute('x', self.posX);
      //rocket.style.transform="translateX("+self.posX+"px) translateZ(0)";
        return self;
    }
    }


    let rocketGame=new Rocket();

    function mouseMove(e) {
    var relativeX = e.clientX - field.offsetLeft;
    if(relativeX > 0 && relativeX < widthField) {
      rocketGame.posX = relativeX - widthRocket;
      rocketGame.update();
     // console.log(rocketGame.posX = relativeX - widthRocket/2)
    }
}

//score    
    let score=0;

      var scoreSVG=document.createElementNS("http://www.w3.org/2000/svg",'text');
      scoreSVG.setAttribute('x', widthField/2);
      scoreSVG.setAttribute('y', clientHeight*0.05);
      scoreSVG.setAttribute('fill', '#7FFF00');
      scoreSVG.setAttribute('font-weight', "bold");
      scoreSVG.setAttribute('font-family', 'Arial');
      scoreSVG.setAttribute('text-anchor', "middle");
      scoreSVG.setAttribute('font-size', String(widthField*0.04));
    svgGame.appendChild(scoreSVG);

    scoreSVG.innerHTML=`Score: ${score}`


    let play = false;

    function start(){
     // drawBricks()
      play=true;
      ball.speedX=4;
      ball.speedY=3;
      // ball.posX=300;
      // ball.posY=300;
    }

    function keyDown(EO) {
      EO=EO||window.event;
      EO.preventDefault();
      if(EO.keyCode == 39) {
        rightPressed = true;
      }
      if(EO.keyCode == 37) {
        leftPressed = true;
        }
    }

    function keyUp(EO) {
        EO=EO||window.event;
        EO.preventDefault();
        if(EO.key == "ArrowRight") {
          rightPressed = false;
        }
        if(EO.key == "ArrowLeft") {
          leftPressed = false;
        }
    }

    function move(){
      if(play){
        ball.posY+=ball.speedY; // Если мяч двигался вверх со скоростью 2 пикселя за кадр, то теперь он будет двигаться «вверх» со скоростью -2 пикселя, что фактически соответствует движению вниз со скоростью 2 пикселя за кадр.
//низ 
          if(ball.posY+rBall*2>=heightField){
            if(ball.posX>rocketGame.posX&&ball.posX<rocketGame.posX+widthRocket){
              ball.posY=clientHeight-heightRocket-rBall;
              ball.speedY=-ball.speedY;
            }else{
              ball.posX=200;
              ball.posX=200;
              alert("GAME OVER");

            }
            
                
                //ball.posY=heightField-ball.height;
            }
//верх
            if(ball.posY-rBall<0){
                ball.speedY=-ball.speedY;
               //ball.posY=0;
            }

            ball.posX+=ball.speedX;    
            
      //           if(ball.posX > widthField-ballRadius || ball.posX  < ballRadius) {
      //             ball.speedX=-ball.speedX;
      // }
//правее стены      
            if (ball.posX+rBall>=widthField){
                // if(ball.posY+heightBall>=right.posY&&ball.posY<=right.posY+heightRocket){
                //     ball.posX=widthField-ball.width-widthRocket;
                    ball.speedX=-ball.speedX;
                // }else if(play===true){
                //     countText=`${pointLeft+=1}:${pointRight}`;
                //     count.innerHTML=countText;
                //     ball.speedX=0;
                //     ball.speedY=0;
                //     play=false;
                // }         
            }

//левее стены
            if (ball.posX-rBall<0){
                // if(ball.posY+heightBall>=left.posY&&ball.posY<=left.posY+heightRocket){
                //     ball.posX=widthRocket;
                    ball.speedX=-ball.speedX;
                // }else if(play===true){
                //     countText=`${pointLeft}:${pointRight+=1}`;
                //     count.innerHTML=countText
                //     ball.speedX=0;
                //     ball.speedY=0;
                //     play=false;
                // }
            }
          }

            if(rightPressed) {
              rocketGame.right().update();        
            }
            if(leftPressed) {
              rocketGame.left().update(); 
            }


        ball.update();
        
        collisionDetection();
        
        RAF(move);
        }
        move();

      //  N.10 Выбор случайных цветов радуги
    //     function randomDiap(n,m) {
    //         return Math.floor(Math.random()*(m-n+1))+n;
    // }

    // function mood(colorsCount) {
    //     var colors=[ '', 'красный', 'оранжевый', 'жёлтый', 'зелёный', 'голубой', 'синий', 'фиолетовый' ];

    //     console.log( 'цветов: ' + colorsCount );
    //     for ( var i=1; i<=colorsCount; i++ ) {
    //         var n=randomDiap(1,7);
    //         var colorName=colors[n];
    //         console.log( colorName );
    //     }
    // }

    // mood(3);





// const mediaQuery = window.matchMedia('(max-width: 780px)')
// function handleTabletChange(e) {
//   if (e.matches) {
//     console.log('Media Query Matched!')
//         field.style.width='100vw';
//     let widthFieldMob=field.style.width;
//     console.log(widthFieldMob)
//     ball.setAttribute('r', document.documentElement.clientWidth*0.035);
//   }
// }
// mediaQuery.addListener(handleTabletChange)
// handleTabletChange(mediaQuery)

  </script>
  
</body>
</html>

<!-- // const windowInnerHeight = document.documentElement.clientHeight
// let container=document.querySelector('.container');
// container.style.height=windowInnerHeight+'px';
// console.log(windowInnerHeight) -->

